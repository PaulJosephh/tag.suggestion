<document>
	<date>2013-06-18</date>
        <title>
Eedomus: Pilotez votre Roomba en Wifi</title>
        <author>Cdric Locqueneux</author>
        <tags_set>
                <tag>eedomus</tag>
                <tag>Roomba</tag>
                <tag>Roowifi</tag>
        </tags_set>
        <categories_set>
                <category>Guides Box Domotique</category>
        </categories_set>
        <text>Nous avons decouvert hier la carte  RooWifi , une petite carte qui vient se brancher sur la prise PS2 du  Roomba  pour ensuite permettre den prendre le controle en Wifi. Comme nous avons vu, il existe une API complete, qui permet ainsi dintegrer facilement le Roomba a son systeme domotique. Voyons voir un exemple aujourdhui avec notre box  eedomus .  
 I. Recuperation des informations  Premiere chose, deja, si on veut se faciliter la vie: desactiver le nom dutilisateur et le mot de passe de la carte Roowifi, sinon on pourra avoir du mal a acceder aux informations a cause de la demande didentification. Comme cest pour une utilisation locale, ce nest pas tres grave. Ensuite, pour acceder aux informations, nous avons deux choix possibles. Le fichier http://IP_DU_ROOMBA/roomba.xml , qui va nous donner une liste complete des options et de leurs valeurs:   Et le fichierhttp://IP_DU_ROOMBA/rwr.xml , plus light, qui naffiche que les valeurs:   Cest ce fichier que nous utiliserons, plus facile a interroger et plus leger. Sur l eedomus , il suffira en effet de creer un nouveau peripherique capteur http   Que nous configurerons de cette facon:   On indique ladresse du fichier rwr.xml, puis on indique le chemin Xpath de la donnee a recuperer. Ici je veux recuperer letat de la charge, qui dapres le premier fichier roomba.xml est donc r18. Le chemin Xpatch est donc /response/r18 . Sur le tableau de bord, on obtient cela:   On peut ainsi recuperer les informations quon souhaite (temperature du Roomba, etc) de la meme facon, en indiquant simplement le chemin XPath de la donnee a recuperer, et faire des scenarios si on veut, comme par exemple faire retourner le Roomba a sa station si la batterie devient trop faible.  
 II. Pilotage  Le pilotage se fera via des requetes HTTP, chose que maitrise tres bien l eedomus . Les ordres sont plus restreints, mais suffiront a notre utilisation. Les commandes sont au nombre de trois: http://IP_DU_ROOMBA/roomba.cgi?button=CLEAN : lancera le nettoyage automatique http://IP_DU_ROOMBA/roomba.cgi?button=SPOT : lancera un nettoyage sur une zone concentree http://IP_DU_ROOMBA/roomba.cgi?button=DOCK : fera repartir le Roomba sur sa station de charge Sur l eedomus  il faut donc creer cette fois un actionneur HTTP:   On lui donne un nom:   Et dans les valeurs on renseigne les commandes HTTP de cette facon:   On obtient alors ce peripherique sur l eedomus , avec les differentes commandes quon peut lancer sur le Roomba:   Bien sur, ces commandes sont utilisables dans des macros et des scenarios. La premiere utilisation qui me vient a lidee est de lancer le mode nettoyage quand on active lalarme en partant:   Comme ca le menage est fait automatiquement quand on nest pas la :p A contrario, si on veut etre tranquille quand on arrive, sil est en fonctionnement on peut lui envoyer la commande DOCK quand on desactive lalarme en rentrant a la maison. Petite chose a prendre en compte toutefois: si par exemple le Roomba est en cours de nettoyage et que jenvoie une commande DOCK pour quil retourne a sa station, cela va avoir pour effet de le stopper. Il faut lui renvoyer une seconde commande DOCK pour quil sexecute (apparemment une commande sexecute, une seconde stoppe).  
 III. Conclusion  Voici un exemple simple dutilisation de la carte RooWifi avec la box eedomus. Pas besoin de script, cette box a tout ce quil faut pour parfaitement utiliser la carte RooWifi et piloter votre Roomba :D Bien sur dautres box pourront egalement le faire, je pense notamment a la  Zibase  qui peut lire des fichiers xml et envoyer des requetes HTTP. Nous verrons un autre exemple avec une autre box que vous appreciez beaucoup dans quelques jours ;-)    eedomus   Roomba   Roowifi 
        </text>
</document>
