<document>
	<date>2012-03-22</date>
        <title>
Kira128: un metteur IR en rseau</title>
        <author>Cdric Locqueneux</author>
        <tags_set>
                <tag>Keene</tag>
                <tag>KIRA</tag>
                <tag>KIRA128</tag>
        </tags_set>
        <categories_set>
                <category>Test Peripheriques Domotiques</category>
                <category>Tests Audio / Video</category>
        </categories_set>
        <text>Maintenant que ma box  eedomus  pilote toute ma maison en Zwave, je cherchais une solution pour piloter mes appareils IR, notamment mes appareils audio video. L eedomus  nest pas (encore ?) compatible avec l Usb Uirt , il fallait donc trouver une autre solution. Cest ainsi que jai decouvert  la gamme dappareils Keene, disponible chez notre partenaire Planete Domotique , et plus particulierement  le modele KIRA128 , un emetteur IR qui peut etre pilote par des requetes HTTP (chose que l eedomus  sait tres bien faire), etqui dispose dune memoire lui permettant dapprendre 128 commandes ! Je vous fais donc profiter de cette trouvaille, car cette solution pourrait bien en depanner plus dun ;-)  
 I. Deballage   Le Kira128 est un petit boitier livre complet:   On retrouve le Kira (le petit boitier carre blanc), une alimentation avec les differents embouts selon le pays, un emetteur IR deporte (quon colle souvent devant le recepteur dune TV par exemple), et une petite notice, qui indique ladresse ou telecharger logiciel et mise a jour, histoire davoir toujours la derniere version. Le Kira128 est un tout petit boitier, puisquil ne mesure que 65 x 65 x 28 mm.   Un peu plus gros que notre Usb Uirt bien connu, certes:   Mais les fonctions sont un peu plus evoluees. Sur le devant, on trouvera des leds indiquant letat du Kira (emission, reception), un recepteur IR, et un petit bouton de reset.   A larriere, nous avons le connecteur dalimentation, une sortie IR pour y brancher lemetteur deporte, une entree IR pour y brancher un recepteur externe, et enfin le port ethernet pour mettre ce petit boitier en reseau.   Esthetiquement, cest moins joli quun  SQBlaster en bois comme nous avions teste , mais dune part le prix nest pas le meme, puisque le Kira ne coute que 98 (contre 199 pour le SQBlaster), et dautre part, etant donne les accessoires disponibles pour le Kira, ce dernier est plutot destine a etre cache. Il existe en effet tout une panoplie de recepteurs externes, a poser sur un meuble, ou a passer au travers, comme ces recepteurs traversant, disponibles en plusieurs couleurs (noir, chrome, laiton), qui se feront tres discrets:   Il existe meme des recepteurs a encastrer dans un mur:   Concernant les emetteurs, cest du classique, des petits emetteurs IR a coller devant lappareil,   ou des emetteurs haute puissance, capables darroser tous les appareils IR se trouvant en face deux a moins dune dizaine de metres:   Bref, il y a du choix. Et malgre la sortie IR unique a larriere du KIRA, vous pourrez sans probleme connecter plusieurs emetteurs deportes, en utilisant simplement des dedoubleurs jack stereo 3.5 (stereo, surtout, les mono ne fonctionnant pas, car le Kira alimente egalement les emetteurs).   On peut ainsi avoir une configuration relativement tentaculaire a laide de dedoubleurs et meme de rallonges jack. Chez moi, par exemple, le Kira peut recevoir des commandes depuis un recepteur deporte pose sur le meuble TV, tres discret, et controler 4 appareils: la TV, lampli Home Cinema et lampli du  Buttkicker  caches dans le meuble TV, et un peu plus loin un spot led RGD pour les ambiances lumineuses.  
 II. Configuration  Les emetteurs / recepteurs Keene peuvent fonctionner de trois facons differentes: en mode recepteur: le boitier recoit les ordres IR et les retransmet sur le reseau en mode transmetteur: le boitier recoit les ordres IR du reseau et les retransmet sous forme IR. En utilisant deux boitiers, lun en reception, lautre en emission, il est donc possible de piloter des appareils a travers de longues distances en mode autonome: le boitier peut recevoir des commandes IR et en emettre. Cest ce dernier mode qui nous interesse, dautant plus que le modele teste ici est un modele disposant dune memoire pour stocker les ordres IR. La configuration se fera via un petit utilitaire en java,  telechargeable sur le site de Keene . Etant en java, ce petit utilitaire fonctionne aussi bien sur Windows que sur Mac ou Linux :D Il faudra simplement installer la machine virtuelle java sur votre ordinateur si ce nest pas deja fait. Ensuite, une fois lance, on obtient cet ecran:   Lutilitaire trouvera automatiquement le Kira sur votre reseau (ladresse IP du Kira sera affichee en bas de lecran). En bas de lecran, les boutons Options page et Setup Page vous permettront dacceder a la configuration du Kira via son interface web:   Le Kira est ici parametre en tant que module autonome. Ces parametres devraient convenir a la plupart des utilisations. Il est ensuite possible de configurer une adresse IP fixe, ce qui est preferable si on souhaite appeler le Kira dans depuis dautres appareils:   On peut meme utiliser un DynDNS si on veut pouvoir se connecter au Kira de lexterieur sans avoir a connaitre son adresse IP:   Mais revenons a lutilitaire java, car cest par lui que se deroulera la configuration qui nous interesse: lapprentissage des codes de notre telecommande. On commence par indiquer au Kira quil doit envoyer les codes IR receptionnes au PC sur lequel nous avons lance lutilitaire de configuration. Pour cela, on clique sur le bouton Send to this PC. Ensuite, on clique sur le gros bouton vert Learn: il ny a plus qua placer votre telecommande en face du Kira, et dappuyer sur la touche que vous souhaitez lui apprendre. Aussitot vous verrez le code IR apparaitre dans la fenetre:   Une fois le code correctement receptionne, vous pouvez cliquer sur Stop. Vous pouvez alors indiquer un nom de fichier et cliquer sur Save code with name si vous souhaitez enregistrer le code dans un fichier texte sur votre pc. Ca pourra servir pour les recharger plus tard en cas de besoin:   Les codes seront alors disponibles dans le repertoire Kira sous forme de fichiers textes:   Ensuite, vous pouvez charger le code dans la memoire du Kira. Vous selectionnez lemplacement memoire dans la liste deroulante, de 1 a 128, puis vous cliquez sur Upload to module.   Lemplacement selectionne prendra le nom indique pour lordre IR. Vous pouvez ensuite tester votre code IR en cliquant sur le bouton blast this location, en placant bien sur lemetteur IR du Kira devant lappareil a piloter. Si votre appareil reagit comme attendu, cest gagne. Recommencez la procedure pour tous les codes a apprendre. Cest un peu long, mais tres facile a realiser.  
 III. Utilisation  Le Kira peut etre pilote par son interface Web, qui va afficher 128 boutons, reprenant le libelle des commandes que vous aurez entre:   Un simple clic sur le bouton desire declenchera lenvoi de lordre IR par le Kira, pour piloter votre appareil. Cest tres rapide. Une interface pour mobile est egalement embarquee:   En plus de cela, le Kira est deja compatible avec de nombreux programmes, comme: EventGhost Software  Intelliremote software  Touch IR iPhone/iPad/iPod Touch software  DemoControl HD iPhone/iPad   Mais ce qui nous interesse particulierement ici, cest de pouvoir utiliser le KIRA128 avec nos solutions domotiques, sans avoir a recourir a un logiciel supplementaire. Bonne nouvelle, cest tout a fait realisable, et tres facilement: quand on etudie la page web du Kira permettant de declencher un ordre IR, on sapercoit quil est fait appel a une requete http de cette forme: http://IP_DU_KIRA/remote2.htm?buttonNUMEROBOUTON Par exemplehttp://192.168.0.10/remote2.htm?button001 pour envoyer lordre IR correspondant au premier bouton parametre. Autrement dit, le Kira est pilotable depuis nimporte quelle box ou logiciel sachant appeler des requetes http. Voyons voir cela avec quelques exemples.  
 1. Avec la Zibase  Avec la  Zibase , il suffira de creer un scenario en utilisant commander par http et en saisissant ladresse vue precedemment:   Lappel de ce scenario permettra de controler lappareil voulu. Bien sur, sagissant dun scenario, il pourra etre declenche manuellement, mais egalement en fonction de certaines circonstances (par exemple allumer la TV automatiquement tous les jours a 20h pour suivre les actualites)  
 2. Avec la Vera  Avec la  Vera , on peut egalement utiliser le Kira. Il faudra par contre recourir a une petite ligne de code lua de ce type dans un scenario:  luup.inet.wget(http://192.168.0.10/remote2.htm?button001) return true   La encore, sagissant dun scenario, on pourra declencher la commande manuellement ou sur un evenement particulier. Enfin, pour une meilleure presentation visuelle, on pourra lier ces scenarios a linterface creee avec  SQDesigner , pour obtenir quelque chose dans ce genre:   
 3. Avec le Home Center de Fibaro  Je ne vous en ai pas encore parle plus en detail, car jattend la prochaine mise a jour et un peu plus dinfos sur le fonctionnement. Mais une mise a jour recente du  Home Center  a ajoute la possibilite de creer des devices virtuels, normalement destines a envoyer des commandes tcp a un peripherique reseau. Mais en rusant un peu, il est tout a fait possible denvoyer des requetes http, et donc de controler le Kira128. Pour cela, on cree un device virtuel et on le parametre de cette facon:   On indique ladresse IP du Kira, puis dans string to send, on passe cette commande: GET /remote2.htm?button001 HTTP/1.10x0D0x0A0x0D0x0A  en indiquant bien sur le numero du bouton quon souhaite controler sur le Kira. On obtient un module bien presente, reprenant les differents boutons quon a configure pour le device virtuel:   Il est meme possible de personnaliser licone de chaque commande si on le souhaite. Par contre, pour le moment il nest pas encore possible dutiliser ces devices virtuels dans les scenarios. Mais ca ne devrait pas tarder a arriver  
 4. Sur leedomus  Cest avec cette box que lutilisation du Kira minteressait particulierement, puisque cest celle que jutilise pour la maison. Et apres avoir teste le Kira avec les differentes solutions, je dois avouer que cest avec l eedomus  que le Kira sutilise le mieux. Il faudra tout dabord creer un module requetes HTTP:   Et ensuite indiquer les requetes a executer sur longlet Valeurs:   Dans URL on indique donc ladresse IP du Kira, puis dans parametres le bouton a controler. Petit detail sympa sur l eedomus , un peu comme pour la box de Fibaro: la possibilite de personnaliser les icones de chaque commande. Ainsi, dans son interface de pilotage, on obtient cela:   Bien sur, on ne va pas ajouter de cette facon les 128 commandes du Kira, ce serait vite ingerable. Dans mon cas, comme le Kira controle a la fois le Plasma, lampli Home Cinema, le Buttkicker et un spot Led, jai cree 4 modules HTTP portant chacun le nom de lappareil, chaque module contenant uniquement les commandes correspondant a lappareil en question:   Il me reste encore un peu de travail, notamment les icones a personnaliser, mais voila un exemple concret de ce quon peut obtenir. Enfin, une fois nos commandes parametrees sur l eedomus , elles sont utilisables manuellement, mais egalement dans des scenarios. Il est alors tres facile de baisser la lumiere a 50%, allumer la TV, lampli HC, et selectionner la source souhaitee. Ya plus qua profiter du film :p  
 IV. Conclusion  Jai cherche au debut un moyen dutiliser lUsb Uirt sur leedomus, ou encore le SQBlaster, mais sans vraiment de succes. Le premier necessite un developpement de la part de  Connected Object , et le second dispose dune API un peu trop compliquee. Finalement jai decouvert le Kira128 de Keene, qui est vraiment pratique: on y stocke les ordres IR de ses appareils, puis on peut appeler les commandes via des requetes HTTP. Du coup, cela en fait sans doute lun des controleurs IR les plus universels, car utilisable depuis quasiment nimporte quelle box ou logiciel. Malgre des fonctions completes (possibilite de gerer les macros, par exemple), le Kira128 est vraiment simple a utiliser, et pour un prix tres honnete, puisque  vendu 98 chez Planete Domotique . Seule chose a savoir: il nest pas compatible IRDA, et ne pourra donc pas controler certaines climatisations utilisant ce protocole. A part ca, pas de probleme pour la plupart des appareils IR (equipements Audio Video, Robots aspirateurs, etc). Pour ma part il est adopte pour gerer toute la partie audio / video de la maison !   Keene   KIRA   KIRA128 
        </text>
</document>
