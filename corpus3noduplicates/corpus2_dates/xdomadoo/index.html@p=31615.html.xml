<document>
	<date>2014-02-26</date>
        <title>Cration de scnarios (blocs graphiques et LUA) avec le Home Center 2</title>
        <author> Bruno </author>
        <tags_set>
                <tag>fibaro</tag>
                <tag>guide</tag>
                <tag>hc2</tag>
                <tag>Home Center 2</tag>
                <tag>lua</tag>
                <tag>programmation</tag>
                <tag>scenario</tag>
                <tag>scene</tag>
                <tag>tuto</tag>
        </tags_set>
        <categories_set>
                <category>Guide Domotique Z-Wave</category>
                <category>Z-Wave Applications</category>
        </categories_set>
        <text>
                                                         La grande utilite de la  Domotique Rendez-vous sur linterface de votre Home Center 2 dans la rubrique Scenes. Cliquez sur Ajouter dans Ajouter une scene. 1- Creation de scenarios en utilisant les blocs graphiques : Il sagit de la methode la plus simple pour creer vos scenarios (association de blocs graphiques). Voici les blocs que vous pouvez mettre en place :  La meteo (temperature, humidite, vitesse du vent, conditions meteo) : Vous pouvez creer un scenario en fonction des conditions exterieures suivantes : 1) Temperature 2) Humidite 3) Vitesse du vent 4) Conditions meteo Exemple de scenario : Ne pas arroser mon jardin lorsquil pleut. Autres exemples : fermer les volets roulants durant lete si le temps est degage (pour eviter une augmentation de la temperature de vos pieces et ainsi limiter lusage de la climatisation) ou inversement durant lhiver (apport gratuit du chauffage grace au soleil).  Variables : Pour vos scenarios, vous pouvez utiliser des variables personnalisees. Lorsque vous creez un scenario, celui-ci peut sactiver en fonction dune variable. Exemple de scenario : Lorsque mon detecteur detecte un mouvement dans mon salon durant la nuit, ma lumiere sallume. Nous voulons que notre lumiere sallume  automatiquement uniquement durant la nuit Apres avoir cree les variables Jour et Nuit, nous creons deux scenarios. Le premier indiquant que du lundi au vendredi, au coucher du soleil, la variable sera Nuit. Le second scenario indiquant que du lundi au vendredi, au lever du soleil, la variable sera Jour. Nous creons maintenant notre scenario desire qui est que si il y a une detection de mouvement durant la nuit, alors la lumiere sallume automatiquement. Voici notre scenario :  Timers  (base sur un intervalle, jours de la semaine, jour du mois, une fois)  Les Timers permettent de creer des scenarios : 1) A partir dun intervalle de temps (exemple : de 10h a 20h toutes les 2 heures). 2) En fonction des jours de la semaine (exemple : action qui sexecute du lundi au vendredi a 7h35) 3) En fonction dun ou plusieurs jours du mois (exemple : action qui sexecute le 7 et 15, chaque mois a 10h15) 4) Pour une seule fois (execution dune action automatique a un seul moment precis) Exemple de scenario : Mes volets roulants souvrent automatiquement du lundi au vendredi a 7h15. Autres exemples : ouvrir mes volets roulants automatiquement le 7, 12, 18 et 25 fevrier a 9h15, ouvrir mes volets roulants automatiquement uniquement le 9 mars a 10h20, recevoir un mail avec une photo prise par ma camera de mon salon de 10h a 20h chaque 2 heures.  Scenes : La rubrique scenes permet dajouter une ou plusieurs scenes deja creees auparavant dans votre scene. Lutilite est dobtenir un scenario plus complexe, prenant compte dautres scenarios. Exemple de scenario : Nous avons cree un premier scenario Detection mouvement (si mon detecteur de mouvement detecte un mouvement alors une sirene senclenche). Nous voulons que ce scenario soit active si notre interrupteur ON/OFF est sur ON. Nous creons donc un second scenario : si mon interrupteur ON/OFF est sur ON, alors mon scenario Detection mouvement sactive.  Commandes : Les blocs de commande permettent de mettre en place des conditions : 1) Etat : ==, , , =, = (exemple : mon detecteur douverture de porte == ON signifie que le detecteur doit etre egal a ON pour respecter la condition du scenario). 2) Association : Alors/Et/Ou (exemple : mon detecteur douverture de porte == ON, ALORS mon interrupteur 1 se met sur ON ET mon interrupteur 2 se met sur OFF). Exemple de scenario : Lorsque les conditions meteos sont bonnes (temps degage), alors mes volets roulants se ferment automatiquement (ce scenario pourrait etre utilise en ete, lorsque le soleil est present pour eviter daugmenter davantage la temperature des pieces).  Pieces : Vous avez la possibilite dinclure des pieces de votre maison dans un scenario pour executer une action sur lensemble des modules de chaque piece (exemple : fermer les stores de toute la piece en meme temps a partir de 21h00). Exemple de scenario : Si il y a une detection de mouvement, alors tous les modules de ma cuisine se mettent sur ON et allument toutes les lampes.  Modules : Vous choisissez les modules (actionneurs/capteurs) que vous mettez en place dans votre scenario pour etre actionne, verifier un etat, lutiliser lors dun evenement (selon le temps, la presence) etc. Vous avez egalement la possibilite dajouter un groupe de modules, pour lequel, laction que vous allez definir agira sur lensemble des modules du groupe (exemple : mon groupe de modules declairage se met sur ON lors dune detection de mouvement. Tous vos modules dans votre groupe se mettront sur ON). Exemple : Si ma porte souvre, alors mon module ON/OFF se met sur ON pour allumer ma lampe.  Cameras :  GPS : 1) Japproche de lemplacement 2) Je pars de lemplacement 3) Jentre dans le perimetre 4) Je sors du perimetre Concretement, avec cette option GPS vous definissez un emplacement dans linterface de votre Home Center 2 (par exemple, celui de votre maison). Grace a votre application mobile  Fibaro Exemple de scenario :Lorsque je mapproche de ma maison, mon interrupteur se met sur ON et allume leclairage de ma porte dentree. Vous creez un lieu au choix dans la rubrique Panneau de localisation, par exemple, vous situez sur la carte, lemplacement de votre maison. Ensuite, dans la creation de scenarios (blocs graphiques), nous indiquons que si nous nous approchons de lemplacement (que nous avons cree ci-dessus), alors linterrupteur ON/OFF se met sur ON automatiquement et allume leclairage de la porte dentree.  Modules Virtuels : Par exemple, vous avez cree un scenario mais vous souhaitez que celui-ci soit active lors de votre depart (vous avez mis en place une sirene qui senclenche lors dune detection de mouvement), vous mettez donc en place un module ON/OFF virtuel (pour eviter den avoir un reel) qui active ou desactive ce scenario (car lors de votre presence, vous ne voulez pas que cette sirene senclenche).  Notifications : SMS Exemple de scenario : Dans la rubrique Panneaux de notifications sur linterface de mon Home Center 2, je cree la notification Lumiere Salon. Le message de cette notification est bonjour, quelquun a allume la lumiere du salon. Pour mon scenario, lorsque mon interrupteur ON/OFF se met sur ON (il active donc la lumiere de mon salon), alors je recois un message par email de cette notification Lumiere Salon. 2- Creation de scenarios en LUA :  Identification des numeros ID des modules : Chaque module disponible dans linterface de votre Home Center 2 a un deviceID (numero identifiant du module). Vous devez tout dabord connaitre les numeros ID de tous vos modules que vous utiliserez pour votre scenario (par exemple, supposons que vous souhaitez creer un scenario en utilisant votre module FGS-211 qui commande leclairage ainsi que votre module FGK-101 qui detecte une ouverture de porte/fenetre, vous devrez donc connaitre leur numero ID) Rendez-vous dans la rubrique Modules et selectionnez chacun de vos modules pour visualiser leur numero ID. Attention : Vous verrez des exemples de scenarios ci-dessous avec des numeros ID qui ne seront pas forcement les memes que les votres (chacun de vos modules peut avoir un numero ID different de ceux presentes dans nos exemples).  Debut et fin dune scene : 
 [[ %% globals Et finir avec le mot : 
 end  Commande dun module : 
 fibaro DeviceID correspond au numero didentifiant de votre module, ActionName est le type daction que votre module doit realiser. Pour un module ON/OFF, les actions secrivent turnOn et turnOff, pour un variateur dont vous voulez une valeur precise, laction secrit SetValue (suivi dun nombre correspondant a la variation desiree de 0 a 100%). Par exemple, pour un module ON/OFF ayant un numero ID de 17 que vous souhaitez activer, voici le resultat : 
 fibaro Avec la fonction SetValue (que vous ajoutez dans votre commande), vous pouvez mettre en place une variation comprise entre 0 et 100%. Par exemple, vous voulez que votre eclairage soit a 65% de sa luminosite. Votre module variateur ayant un numero ID de 89, voici le resultat : 
 fibaro Vous pouvez retrouver lensemble des  actions de vos modules ici  Connaitre letat dun module, stocker la valeur et controler le deroulement du scenario : fibaro fibaro Par exemple, nous voulons que la television (ayant un numero ID de 79) sallume et visualiser si elle a bien ete allumee.Nous devons declarer la variable (local NomVariable), allumer lappareil ( fibaro fibaro fibaro 
 local ModuleTv fibaro fibaro:call(36, turnOn) ModuleTv = fibaro:getValue(36, value) fibaro:debug(Ma television est :  ModuleTv) (Nous aurons sur lecran debogue les informations suivantes : Ma television va etre allumee et Ma television est : 1).  Declenchement automatique dun module : Par exemple, vous souhaitez que le chauffage de votre salon soit declenche automatiquement si vous ouvrez la fenetre pour eviter des depenses inutiles. Le module commandant votre chauffage a un numero ID de 53, le module detecteur douverture de fenetre a un numero ID de 86. Vous devez tout dabord creer votre entete sans oublier dajouter le numero ID du detecteur suivi de Value : 
 [[ 86 Value %% globals Vous continuez ensuite votre scenario avec : 
 Local DetecteurOuverture DetecteurOuverture = fibaro:getValue(86, value) If (DetecteurOuverture == 1) then Fibaro:call(53, turnOff) end (Nous avons indique DetecteurOuverture mais vous pouvez choisir le nom que vous desirez pour identifier votre module).  Extinction dun module apres une duree determinee : 
 fibaro:sleep(time) Par exemple, vous souhaitez que lorsque le module ON/OFF qui commande votre lumiere se mette sur ON (pour eclairer) puis sur OFF apres 9 secondes (ce module a un numero ID de 47). Voici la partie de scenario que vous devez ecrire : 
 fibaro:call(47, turnOn  ) fibaro:sleep(9000) fibaro:call(47,  turnOff ) (Nous avons indique 9000 car le temps doit etre exprime en ms).  Conditions : Les principales fonctions sont : IF (SI), THEN (ALORS) et ELSE (SINON). Par exemple, SI votre detecteur de mouvement detecte un mouvement ALORS le module qui commande votre sirene se met sur ON et active celle-ci (numero ID du detecteur de mouvement et module ON/OFF de votre sirene : 52 et 86). Voici la partie de scenario que vous devez ecrire : 
 local DetecteurMouvement DetecteurMouvement = fibaro:getValue(52, value ) if (DetecteurMouvement == 1 ) then fibaro:call(86,  turnOn ) (Nous avons indique DetecteurMouvement mais vous pouvez choisir le nom que vous desirez pour identifier votre module tout en respectant lecriture du scenario).  Action realisable durant une periode definie : Par exemple, nous voulons que la lumiere de notre salon sallume si le detecteur detecte un mouvement de 21h a 6h du matin. Le module qui commande leclairage de notre salon a un numero ID de 43 et notre detecteur de mouvement a un numero ID de 35.Voici notre scenario : 
 %% properties 35 value %% globals local DetecteurMouvement = os.date(*t) DetecteurMouvement = fibaro:getValue(35, value ) if (DetecteurMouvement == 1 andDetecteurMouvement [hour] = 21 and DetecteurMouvement [hour] = 06 ) then fibaro:call(43, turnOn) end  Scenario en LUA qui regroupe lensemble des fonctions presentees dans cet article : Voici notre scenario : 
 %% properties 26 value %% globals local DetecteurMouvement = os.date(*t) DetecteurMouvement = fibaro:getValue(26, value ) if (DetecteurMouvement == 1 andDetecteurMouvement [hour] = 22 and DetecteurMouvement [hour] = 05 ) then fibaro:debug( Ma lumiere va etre allumee ) fibaro:call(39, setValue,  60 ) DetecteurMouvement = fibaro:getValue(26, value) fibaro:debug(Ma lumiere est :  DetecteurMouvement) fibaro:sleep(30000) fibaro:call(39,  turnOff ) end Pour des scenarios plus complexes, il existe bien evidemment davantage de fonctions que vous pouvez retrouver sur le  manuel officiel du LUA  Simple Share Buttons Adder (5.6) simplesharebuttons.com  
 Ces sujets pourraient vous interesser aussi: Aucune proposition. END .entry-content  
        </text>
</document>
