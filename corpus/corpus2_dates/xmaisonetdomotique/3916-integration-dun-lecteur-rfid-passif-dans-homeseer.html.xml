<document>
	<date>2011-03-03</date>
        <title>
Intgration dun lecteur RFID Passif dans Homeseer</title>
        <author>Stephane</author>
        <tags_set>
                <tag>Homeseer</tag>
                <tag>RFID</tag>
        </tags_set>
        <categories_set>
                <category>Guides Securite</category>
        </categories_set>
        <text>Puisque mon installation Homeseer gere lensemble du systeme dalarme, il me fallait un moyen pratique, rapide et surtout compatible  WAF (Wife Acceptance Factor)  pour lactiver ou la desactiver. Jai donc fait quelques recherches sur plusieurs dispositifs et mon choix sest rapidement porte sur du RFID passif. Mais voila, ce genre de technologie nest pas facilement disponible aux particuliers et est souvent packagee (Lecteur, tags et logiciel). Pour ma part, jetais convaincu quavec un lecteur RFID simple, quelques tags et surtout pas mal de temps, je serais capable de faire un systeme totalement integre dans Homeseer.  
 I. Le materiel.  Jai beaucoup cherche sus internet et je suis tombe sur  un site chinois , plutot a Hong-kong, me proposant lensemble du materiel:   Lecteur RFID: Frequence dutilisation 125Khz, 45x80x15 mm; distance de lecteur 8-10cm, interface de transfert des donnees RS252, alimentation 9-12 VDC. Tarif $39   Tags RFID a monter sur porte-cles: 40x32x4 mm. Tarif: $1 Jai choisi de commander deux lecteurs RFID et 10 tags pour un total, en ajoutant les frais de livraison $30, de $118, soit 90 euros environ. Paiement effectue par Paypal. Ayant eu un excellent contact avec la societe, et sachant queventuellement des frais de douane pouvaient aussi sajouter au montant total, je me suis dit que le risque etait mesure. Une bonne dizaine de jours plus tard et sans frais de douane, jai recu ma commande dans un colis bien conditionne avec lensemble des articles et quelques elements supplementaires comme une pile 9V et quelques tags de differentes couleurs.   Le lecteur est livre deja connecte en RS232, avec un mini-guide de test. Pour verifier son fonctionnement, jai connecte le lecteur a mon PC et lance HyperTerminal. Apres avoir passe quelques badges, voici le resultat.   Ce lecteur repond parfaitement a ma demande. Tout est pret pour linstallation.  
 II. Linstallation  La partie installation a ete assez rapide. Un lecteur etait prevu a lexterieur, lautre a linterieur, jai dabord tendu deux cables RJ45 entre mon serveur Homeseer et les lecteurs. Une seule paire est necessaire, mais jai pour principe de laisser toujours des paires disponibles pour une panne ou pour une evolution future.   Jai egalement ajoute dans mon serveur Homeseer une carte 2 ports RS232 que jai achetee chez  LDLC . Dun point de vue fiabilite, je trouve que les connexions RS232 directes sont plus robustes que les emulations USB-Serie.   Puis jai connecte le lecteur RFID dun cote et le port RS232 de lautre. Ensuite, jai ajoute une alimentation 9VDC (Convertisseur 220VAC-9VDC) achetee dans mon supermarche, mais on trouve facilement  ce type de transformateur a la Fnac . Une fois que tout est installe, jai refait le test simple avec HyperTerminal. Encore un resultat concluant, la plus grosse etape reste a venir.  
 III. Lintegration dans Homeseer  Cette partie a pris plus de temps que prevu, je pensais que Homeseer etait capable de gerer directement le port serie en mode wait (cest-a-dire par notification), mais helas, ce nest pas le cas. Apres plusieurs essais avec des scripts, jai decide decrire mon propre plug-in. (Merci a Stipus pour son code source dexemple).  Telecharger le plugin RFID Pour lutiliser, il faut quitter Homeseer, puis ajouter dans le repertoire de votre installation Homeseer le fichier suivant:  hspi_thxrfid.dll  puis copier le repertoire  hspi_thxrfid  dans le repertoire html de votre installation Homeseer.   Ensuite, apres redemarrage de Homeseer, il faut creer un Device status Only. Pour cela cliquez sur Add Device dans le menu Device et personnalisez votre module avec des lettercode/unicode disponibles, et mettez Status Only dans Device Type.   Vous devez ensuite aller dans le menu Tools-Setup/Configuration-Interfaces, puis cliquer sur le bouton Disabled, devant linterface Passive Rfid, enfin sur Save en bas de lecran.   Ensuite, vous devez cliquer sur le bouton Config en face de Passive Rfid pour acceder a la configuration:   Cest un plug-in tres simple, on indique le numero de port (avec le mot Com devant) et le code du device que lon a cree precedemment. Cliquez, enfin, sur le bouton Save Config, vous devriez trouvez dans votre log Homeseer la ligne suivante:  06/09/2010 16:01:00 Passive Rfid Initialisation Com10 successful  Apres avoir repasse un badge devant le lecteur, jai maintenant le numero didentification dans le device. A noter, le plug-in met le device a ON quand un badge est lu. Cela sera utile pour la prochaine etape.  
 IV. Resultat final  Il reste maintenant letape de gestion de lactivation/desactivation. Pour cela, jai cree un script base sur le changement de status du device. Pour cela il suffit de cliquer sur Add Event dans le menu Event   Puis dans la partie Trigger, il faut selectionner Device Status Change dans la partie Current Trigger Type et choisir votre device dans la liste Device, puis Changed to On dans Status.   Enfin dans la partie Action, mettez laction que vous souhaitez realiser, pour le test jai mis un message sonore, puis ajoutez a la fin un Device Action Off sur votre device. Attention: Il est important de mettre toujours Off sur votre device apres laction sinon levenement ne se produire quune seul fois!   Voila, cest termine. Dernier test avec le badge et Homeseer me parle!  
 V. Conclusion  La 1ere etape de mon installation est realisee, reste maintenant a programmer lensemble avec le plug-in RFXCOM qui gere une partie de lalarme. Mais cela sera pour un autre article   Homeseer   RFID 
        </text>
</document>
