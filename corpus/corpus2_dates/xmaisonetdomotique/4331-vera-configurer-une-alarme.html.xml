<document>
	<date>2011-04-13</date>
        <title>
Vera: configurer une alarme</title>
        <author>Cdric Locqueneux</author>
        <tags_set>
                <tag>micasaverde</tag>
                <tag>securite</tag>
                <tag>vera</tag>
        </tags_set>
        <categories_set>
                <category>Guides Box Domotique</category>
                <category>Guides Securite</category>
        </categories_set>
        <text>Souvent, en domotique, on souhaite egalement integrer son systeme dalarme. Ce dernier peut etre un systeme autonome, capable de dialoguer avec le systeme domotique, mais il peut aussi etre totalement partie integrante du systeme domotique. En effet, un systeme dalarme repose sur des capteurs et des actions a realiser en cas de declenchement de lun des capteurs. Rien que ne puisse pas faire un systeme domotique digne de ce nom ! Nous allons donc voir aujourdhui comment configurer un systeme dalarme sur la  Vera de Micasaverde .  
 I. Materiel necessaire  Pour mettre en place un systeme qui tienne la route, il faudra donc, en plus de la  Vera , bien sur, quelques capteurs: capteurs douverture de porte / fenetre capteurs de presence, comme par exemple le  EZ-Motion 3-1 sirene Vous pourrez trouver  une presentation de ces capteurs dans ce test . Pas besoin de posseder la totale, mais il en faut au moins quelques uns. A cela on peut ajouter dautres modules pour controler par exemple des lampes, des volets, etc en fonction du scenario quon souhaite lancer en cas dintrusion. Personnellement, je nai pas cherche du cote des telecommandes pour controler lalarme, tout se faisant a partir de nos telephones (iPhones, avec  lapplication iVera ), ou de lecran tactile de la maison.  
 II. Configuration  La configuration repose sur un element quon sous estime souvent sur la  Vera : la faculte darmer ou de bypasser un detecteur:   Cette option permet daffecter deux comportements differents a un module, selon quil soit arme ou non. Pour un detecteur de presence, on pourrait par exemple lui demander dallumer automatiquement la lumiere de la piece quand il est en bypass, ou alors dactiver la sirene quand il est arme. Et ceci tres facilement. Nous allons commencer par creer deux scenarios dactivation de lalarme, qui seront lances manuellement, lun partiel (uniquement les capteurs douverture) qui permettra dactiver lalarme quand on est encore chez soit, lautre total, qui activera les capteurs douvertures, mais aussi les detecteurs de presence. On cree donc un scenario, auquel on donne le nom Alarme  Partielle. Sur longlet Commands, on coche tous les capteurs a activer en mode partiel (ici les capteurs douvertures), et on demande a les passer en mode Arm.   Petite nuance pour la porte dentree, sur laquelle on peut mettre une temporisation qui permettra de sortir tranquillement de chez soit avant que lalarme soit reellement en route, pratique pour le scenario Alarme  Totale, notamment. Comme je veux avoir une confirmation de mon alarme, sur longlet Luup, jai ajoute un bout de code qui va utiliser les notifications Prowl, afin de nous envoyer un message sur nos iPhone afin de nous confirmer la bonne activation de lalarme:   Si vous ne lavez pas deja fait, je vous invite a lire  mon tuto precedent expliquant comme utiliser les notifications Prowl avec la Vera . On repete exactement la meme operation pour le scenario Alarme  Totale, en cochant en plus les detecteurs de mouvement, et en les passant en mode Arm.   Ici aussi, on peut laisser une temporisation sur certains capteurs si on le souhaite. A noter que certains detecteurs de presence, comme le EZMotion, ne repassent en mode aucune presence detectee quau bout de plusieurs minutes. Donc si on ne laisse pas de temporisation sur ces capteurs, il risquent de declencher lalarme des sa mise en service. Maintenant que nous avons arme les capteurs necessaires, il faut bien sur determiner des actions a effectuer en consequence. On cree donc un autre scenario, appele par exemple Effraction. Ce scenario va se lancer sur declenchement des capteurs, on va donc sur longlet Events, et on ajoute un nouvel evenement:   On selectionne le capteur concerne, et son choisit le type devenement An armed sensor is tripped, puis on choisit Yes dans loption tripped ?. Cela va permettre de ne tenir compte de ce capteur que sil est arme et declenche. Une option interessante, ensuite, et de pouvoir utiliser les notifications automatiques de la  Vera : on donne un titre a levenement, ici Porte Couloir Ouverte, et on coche les utilisateurs qui doivent recevoir lalerte. En cas de declenchement de ce capteur, les utilisateurs (dont le numero de mobile est renseigne sur leur compte Mios) recevront un SMS pour les informer. Ainsi, en plus de savoir que lalarme a ete declenchee, cela permet de savoir precisement ou se situe leffraction. Comme longlet Events de la  Vera  fonctionne en OU, cest a dire que le scenario se declenche si le premier evenement est vrai, OU si le second evenement est vrai, OU sietc on peut donc lister tous les capteurs a tester ici, qui sont utilises par lalarme:   Il ny a plus qua determiner les actions a accomplir suite a cela, en allant sur longlet Commands. Ici, par exemple, jactive la sirene, et je leteins automatiquement apres 15 min (sirene sur batterie).   Les actions a realiser dependent totalement de ce que vous souhaitez faire: on peut par exemple, sil fait nuit, ouvrir automatiquement tous les volets et faire clignoter les lumieres de la maison afin dattirer lattention de lexterieur, declencher un diffuseur de fumee, etc Il suffit que tout ce materiel soit connecte a un module Z-Wave. Il ne reste plus qua prevoir la possibilite de desarmer lalarme, ce qui se fera egalement via un scenario Alarme  Desactivation. On fait ici la meme chose que pour le scenario darmement, sauf que cette fois on passe tous les capteurs en bypass:   Aucune temporisation necessaire ici pour aucun capteur, et on peut egalement, au passage, eteindre la sirene et les differents modules quon aurait pu allumer en cas deffraction. Ainsi, ce scenario servira a desarmer lalarme, quelle soit en alerte ou non. Si elle est en alerte, la sirene et les autres elements allumes sarreteront avec elle. Comme pour lactivation, jutilise aussi un petit bout de code Luup pour menvoyer une notification Prowl sur mon iPhone me confirmant la desactivation de lalarme:   Pour activer ou desactiver lalarme, je peux donc passer soit par linterface web de la  Vera , accessible de nimporte ou, soit passer par lapplication iVera sur mon iPhone, ce qui permet egalement de controler lalarme de nimporte ou:  
 III. Petit recapitulatif  Nous avons donc 4 scenarios: deux dactivation (partielle ou totale) un en cas deffraction et un pour desarmer lalarme, quelle soit en partielle ou totale.  En pratique, voila ce qui se passe: je lance le scenario Alarme Totale depuis mon iPhone quelques secondes plus tard, je recois un message sur mon iPhone me confirmant larmement de lalarme (via une notification Prowl) en cas deffraction, je recois un SMS minformant de lendroit ou se situe lintrusion (quelle porte, quelle piece ?), et la sirene se met en route chez moi (ainsi que tout le reste du scenario que jai pu definir: volets qui souvrent, clignotement des lumieres, etc) depuis mon iPhone, je peux desactiver lalarme a distance en cas de besoin 
 IV. Pour aller plus loin  Si on dispose de cameras connectees a la Vera, il est tout a fait possible de declencher lenregistrement automatique de celles ci. Voici une camera surveillant lentree (voir  mon tuto sur la video surveillance low cost  pour plus dexplications):   En se rendant sur longlet Settings, on peut declencher lenregistrement automatique de la camera si les modules selectionnes sont actives (ouverture dune porte, detection dune presence). Il ny a pas de distinction entre Arm ou Bypass pour les modules, mais ca ne pose pas de probleme, il vaut mieux enregistrer trop que pas assez :p :   La bonne idee, cest que si on a cree son compte Mios lors de la configuration de la Vera, ces enregistrements sont stockes sur les serveurs de  Micasaverde . Du coup, meme si la Vera se fait kidnapper, les enregistrements restent disponibles. Par securite, je conseille de brancher son routeur (ou box internet) et la Vera sur un onduleur: ainsi, meme en cas de panne delectricite, ou de coupure malintentionnee, le systeme dalarme reste actif, car la Vera et le routeur consomment peu et tiendront donc un bon moment sans electricite, et les divers capteurs utilises (ouverture, presence) fonctionnent la plupart sur temps sur batterie. Il ne sagit bien sur ici que dun guide, totalement personnalisable pour repondre a votre besoin, mais cela donnera deja, je pense, une bonne idee sur la maniere de proceder. si vous avez des idees ou suggestions, elles sont les bienvenues dans les commentaires !   micasaverde   securite   vera 
        </text>
</document>
